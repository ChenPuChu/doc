在 x86 保护模式下，**IDT（中断描述符表）** 是 CPU 用来查找 **中断处理程序** 的数据结构。它是一个表，每个表项对应一个 **中断或异常**，存储该中断的处理函数地址等信息。

---

## **1. IDT 结构**

IDT 是一个 **数组，共有 256 个条目**，每个条目 **8 字节**，共 **2KB**。CPU 通过中断号（索引）在 **IDT** 中查找 **中断描述符**，然后跳转到相应的中断处理程序执行。

**IDT 共有 256 项的原因：**

- **0~31**：CPU 预定义的 **异常（Exception）**
- **32~47**：可编程中断控制器（PIC）用于 **IRQ（硬件中断）**
- **48~255**：用户可自定义的软件中断（如 `int 0x80`）

---

## **2. IDT 表项结构（IDT Entry）**

一个 IDT 条目（`IDTEntry`）是 8 字节的结构，如下：

| 字段            | 长度（位） | 作用                 |
| ------------- | ----- | ------------------ |
| `Offset_Low`  | 16    | 处理程序地址的 **低 16 位** |
| `Selector`    | 16    | 代码段选择子（通常是 `0x08`） |
| `Zero`        | 8     | **必须为 0**（保留）      |
| `Type_Attr`   | 8     | **描述符类型**，DPL，P位   |
| `Offset_High` | 16    | 处理程序地址的 **高 16 位** |

### **2.1 `Type_Attr`（类型字段）**

`Type_Attr` 由 **8 位** 组成：

| 位   | 名称     | 说明             |
| --- | ------ | -------------- |
| 7   | `P`    | 1=有效，0=无效      |
| 5-6 | `DPL`  | 特权级（0=最高，3=用户） |
| 4   | `0`    | **保留位**（必须=0）  |
| 3-0 | `Type` | **描述符类型**      |

### **2.2 `Type` 类型字段**

|`Type`|类型描述|
|---|---|
|`0x5`|任务门（Task Gate）|
|`0x6`|16 位中断门（Interrupt Gate）|
|`0x7`|16 位陷阱门（Trap Gate）|
|`0xE`|32 位中断门|
|`0xF`|32 位陷阱门|

**区别：**

- **中断门（Interrupt Gate，`0xE`）**：中断时 **清除 IF（中断允许）**，防止嵌套中断。
- **陷阱门（Trap Gate，`0xF`）**：不会关闭 IF，适合调试。

通常，**中断门 `0x8E`（P=1，DPL=0，Type=E）** 是最常用的。

## **3. 常见中断号**

在 x86 架构下，中断号（Interrupt Number）通常分为三大类：

1. **CPU 异常（Exception，0-31）**
2. **可编程中断控制器（PIC）硬件中断（IRQ，32-47）**
3. **用户定义的软件中断（48-255）**

---

### 1. CPU 异常（Exception，0-31）

这些异常由 CPU 硬件自动触发，主要用于处理程序错误、保护机制等问题。

|中断号|名称|描述|
|---|---|---|
|0|**#DE (Divide Error)**|除零异常（整数除法时除数为零）|
|1|**#DB (Debug Exception)**|断点、单步调试|
|2|**NMI (Non-Maskable Interrupt)**|不可屏蔽中断，通常用于硬件错误或紧急情况|
|3|**#BP (Breakpoint Exception)**|断点中断，`int 3` 指令用于调试|
|4|**#OF (Overflow Exception)**|`INTO` 指令检测到溢出|
|5|**#BR (Bound Range Exceeded)**|`BOUND` 指令检测到范围超出|
|6|**#UD (Invalid Opcode)**|无效操作码（非法指令）|
|7|**#NM (Device Not Available)**|无数学协处理器|
|8|**#DF (Double Fault)**|双重错误|
|9|**Reserved**|保留（早期 CPU 用于协处理器错误）|
|10|**#TS (Invalid TSS)**|无效的任务状态段（TSS）|
|11|**#NP (Segment Not Present)**|段不存在异常|
|12|**#SS (Stack-Segment Fault)**|栈段故障（栈溢出等）|
|13|**#GP (General Protection Fault)**|通用保护错误（访问非法内存、权限错误等）|
|14|**#PF (Page Fault)**|缺页异常|
|15|**Reserved**|保留|
|16|**#MF (x87 Floating-Point Exception)**|FPU 浮点运算错误|
|17|**#AC (Alignment Check)**|内存对齐错误|
|18|**#MC (Machine Check Exception)**|机器检查异常（硬件故障）|
|19|**#XM / #XF (SIMD Floating-Point Exception)**|SIMD 浮点运算异常|
|20-31|**Reserved**|保留，未来可能用于 CPU 新特性|

---

### 2. 硬件中断（IRQ，32-47）

这些中断由 **8259 PIC（可编程中断控制器）** 或 **APIC（高级可编程中断控制器）** 触发，通常用于处理外设（键盘、鼠标、定时器等）。

|中断号|IRQ 号|设备|
|---|---|---|
|32|0|**定时器（Timer）**|
|33|1|**键盘（Keyboard）**|
|34|2|级联（8259A 从 PIC 连接）|
|35|3|串口 2（COM2）|
|36|4|串口 1（COM1）|
|37|5|并口 2 / 声卡|
|38|6|软盘驱动器|
|39|7|并口 1|
|40|8|**实时时钟（RTC）**|
|41|9|备用（一般用于 ACPI）|
|42|10|备用|
|43|11|备用|
|44|12|PS/2 鼠标|
|45|13|FPU / 协处理器|
|46|14|**主 IDE 硬盘**|
|47|15|**从 IDE 硬盘**|

---

### 3. 用户定义的软件中断（48-255）

这些是用户程序可以使用 `int` 指令触发的中断，常用于系统调用。

|中断号|用途|
|---|---|
|48 (0x30)|常见的 **系统调用（syscall）**|
|49-255|可由操作系统自由分配|
